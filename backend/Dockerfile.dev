FROM golang:1.24-alpine

# Install Delve for debugging
RUN go install github.com/go-delve/delve/cmd/dlv@latest

WORKDIR /app

COPY . .

# Expose 8080 for the app, 40000 for the debugger
EXPOSE 8080 40000

# Start the app through Delve
# --headless: run without a UI
# --continue: start the app immediately
# --accept-multiclient: allow VS Code to connect/disconnect
CMD ["dlv", "--listen=:40000", "--headless=true", "--api-version=2", "--accept-multiclient", "debug", "--continue", "--accept-multiclient", "./"]